$schema: 'http://json-schema.org/draft-07/schema#'
$id: canvas-dashboards.schema.yaml
title: Canvas Dashboards YAML
type: object
description: In your Rill project directory, create a canvas dashboard, `<dashboard_name>.yaml`, file in the `dashboards` directory. Rill will ingest the dashboard definition next time you run `rill start`.
allOf:
  - title: Properties
    type: object
    properties:
      type:
        type: string
        const: canvas
        description: Refers to the resource type and must be `canvas`
      display_name:
        type: string
        description: Refers to the display name for the canvas
      banner:
        type: string
        description: Refers to the custom banner displayed at the header of an Canvas dashboard
      max_width:
        type: integer
        description: Max width in pixels of the canvas
        minimum: 0
      gap_x:
        type: integer
        description: Horizontal gap in pixels of the canvas
        minimum: 0
      gap_y:
        type: integer
        description: Vertical gap in pixels of the canvas
        minimum: 0
      theme:
        oneOf:
          - type: string
            description: Name of an existing theme to apply to the dashboard
          - $ref: '#/definitions/theme/definitions/theme_properties'
            description: Inline theme configuration.
        description: Name of the theme to use. Only one of theme and embedded_theme can be set.
      allow_custom_time_range:
        type: boolean
        description: Defaults to true, when set to false it will hide the ability to set a custom time range for the user. 
      time_ranges:
        type: array
        description: Overrides the list of default time range selections available in the dropdown. It can be string or an object with a 'range' and optional 'comparison_offsets'
        items:
          $ref: '#/definitions/explore_time_range_properties'
      time_zones:
        type: array
        description: Refers to the time zones that should be pinned to the top of the time zone selector. It should be a list of [IANA time zone identifiers](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)
        items:
          type: string
      filters:
        type: object
        description: Indicates if filters should be enabled for the canvas.
        properties:
          enable:
            type: boolean
            description: Toggles filtering functionality for the canvas dashboard.
        additionalProperties: false
      defaults:
        type: object
        description: Preset UI state to show by default
        properties:
          time_range:
            type: string
            description: Default time range to display when the dashboard loads
          comparison_mode:
            type: string
            description: Default comparison mode for metrics (none, time, or dimension)
          comparison_dimension:
            type: string
            description: Default dimension to use for comparison when comparison_mode is 'dimension'
        additionalProperties: false
      variables:
        type: array
        description: Variables that can be used in the canvas
        items:
          $ref: '#/definitions/component_variable_properties'
      rows:
        type: array
        description: Refers to all of the rows displayed on the Canvas
        items:
          type: object
          properties:
            height:
              type: string
              description: Height of the row in px
            items:
              type: array
              description: List of components to display in the row
              items:
                type: object
                properties:
                  component:
                    type: string
                    description: Name of the component to display
                  width:
                    type:
                      - string
                      - integer
                    description: Width of the component (can be a number or string with unit) 
                additionalProperties: true
          additionalProperties: false
      security:
        $ref: '#/definitions/security_policy_properties'
        description: Security rules to apply for access to the canvas
    required:
      - type
      - rows
  - $ref: '#/definitions/common_properties'
definitions:
  explore_time_range_properties:
    oneOf:
      - type: string
        description: a valid [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601#Durations) duration or one of the [Rill ISO 8601 extensions](https://docs.rilldata.com/reference/rill-iso-extensions#extensions) extensions for the selection
      - type: object
        description: Object containing time range and comparison configuration
        properties:
          range:
            type: string
            description: a valid [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601#Durations) duration or one of the [Rill ISO 8601 extensions](https://docs.rilldata.com/reference/rill-iso-extensions#extensions) extensions for the selection
          comparison_offsets:
            type: array
            description: list of time comparison options for this time range selection (optional). Must be one of the [Rill ISO 8601 extensions](https://docs.rilldata.com/reference/rill-iso-extensions#extensions)
            items:
              oneOf:
                - type: string
                  description: Offset string only (range is inferred)
                - type: object
                  description: Object containing offset and range configuration for time comparison
                  properties:
                    offset:
                      type: string
                      description: Time offset for comparison (e.g., 'P1D' for one day ago)
                    range:
                      type: string
                      description: Custom time range for comparison period
                  additionalProperties: false
        required:
          - range
        additionalProperties: false
  component_variable_properties:
    type: object
    properties:
      name:
        type: string
        description: Unique identifier for the variable
      type:
        type: string
        description: Data type of the variable (e.g., string, number, boolean)
      value:
        description: Default value for the variable. Can be any valid JSON value type
        type:
          - string
          - number
          - boolean
          - object
          - array
    required:
      - name
      - type
    additionalProperties: false
  security_policy_properties:
    type: object
    description: Defines security rules and access control policies for resources
    properties:
      access:
        oneOf:
          - type: string
            description: SQL expression that evaluates to a boolean to determine access
          - type: boolean
            description: Direct boolean value to allow or deny access
        description: Expression indicating if the user should be granted access to the dashboard. If not defined, it will resolve to false and the dashboard won't be accessible to anyone. Needs to be a valid SQL expression that evaluates to a boolean.
      row_filter:
        type: string
        description: SQL expression to filter the underlying model by. Can leverage templated user attributes to customize the filter for the requesting user. Needs to be a valid SQL expression that can be injected into a WHERE clause
      include:
        type: array
        description: List of dimension or measure names to include in the dashboard. If include is defined all other dimensions and measures are excluded
        items:
          type: object
          properties:
            if:
              type: string
              description: Expression to decide if the column should be included or not. It can leverage templated user attributes. Needs to be a valid SQL expression that evaluates to a boolean
            names:
              anyOf:
                - type: array
                  description: List of specific field names to include
                  items:
                    type: string
                - type: string
                  description: Wildcard '*' to include all fields
                  enum:
                    - '*'
              description: List of fields to include. Should match the name of one of the dashboard's dimensions or measures
          required:
            - if
            - names
      exclude:
        type: array
        description: List of dimension or measure names to exclude from the dashboard. If exclude is defined all other dimensions and measures are included
        items:
          type: object
          properties:
            if:
              type: string
              description: Expression to decide if the column should be excluded or not. It can leverage templated user attributes. Needs to be a valid SQL expression that evaluates to a boolean
            names:
              anyOf:
                - type: array
                  description: List of specific field names to exclude
                  items:
                    type: string
                - type: string
                  description: Wildcard '*' to exclude all fields
                  enum:
                    - '*'
              description: List of fields to exclude. Should match the name of one of the dashboard's dimensions or measures
          required:
            - if
            - names
      rules:
        type: array
        description: List of detailed security rules that can be used to define complex access control policies
        items:
          type: object
          description: Individual security rule definition
          properties:
            type:
              type: string
              enum:
                - access
                - field_access
                - row_filter
              description: Type of security rule - access (overall access), field_access (field-level access), or row_filter (row-level filtering)
            action:
              type: string
              enum:
                - allow
                - deny
              description: Whether to allow or deny access for this rule
            if:
              type: string
              description: Conditional expression that determines when this rule applies. Must be a valid SQL expression that evaluates to a boolean
            names:
              type: array
              items:
                type: string
              description: List of field names this rule applies to (for field_access type rules)
            all:
              type: boolean
              description: When true, applies the rule to all fields (for field_access type rules)
            sql:
              type: string
              description: SQL expression for row filtering (for row_filter type rules)
          required:
            - type
  common_properties:
    type: object
    title: "Common Properties"
    properties:
      name:
        type: string
        description: Name is usually inferred from the filename, but can be specified manually.
      refs:
        type: array
        description: 'List of resource references'
        items:
          type: string
          description: A string reference like `<resource-name>` or `<type/resource-name>`.
      dev:
        type: object
        description: Overrides any properties in development environment.
      prod:
        type: object
        description: Overrides any properties in production environment.
  theme:
    definitions:
      theme_properties:
        type: object
        properties:
          colors:
            type: object
            description: Used to override the dashboard colors. Either primary or secondary color must be provided.
            properties:
              primary:
                type: string
                description: Overrides the primary blue color in the dashboard. Can have any hex (without the '#' character), [named colors](https://www.w3.org/TR/css-color-4/#named-colors) or hsl() formats. Note that the hue of the input colors is used for variants but the saturation and lightness is copied over from the [blue color palette](https://tailwindcss.com/docs/customizing-colors).
              secondary:
                type: string
                description: Overrides the secondary color in the dashboard. Applies to the loading spinner only as of now. Can have any hex (without the '#' character), [named colors](https://www.w3.org/TR/css-color-4/#named-colors) or hsl() formats.
            anyOf:
              - required:
                  - primary
              - required:
                  - secondary 