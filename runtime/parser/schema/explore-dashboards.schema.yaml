$schema: 'http://json-schema.org/draft-07/schema#'
$id: explore-dashboards.schema.yaml
title: Explore Dashboards YAML
type: object
description: In your Rill project directory, create a explore dashboard, `<dashboard_name>.yaml`, file in the `dashboards` directory. Rill will ingest the dashboard definition next time you run `rill start`.
allOf:
  - title: Properties
    type: object
    properties:
      type:
        type: string
        const: explore
        description: Refers to the resource type and must be `explore`
      display_name:
        type: string
        description: Refers to the display name for the explore dashboard
      description:
        type: string
        description: Refers to the description of the explore dashboard
      banner:
        type: string
        description: Refers to the custom banner displayed at the header of an explore dashboard
      metrics_view:
        type: string
        description: Refers to the metrics view resource
      dimensions:
        description: List of dimension names. Use '*' to select all dimensions (default) 
        $ref: '#/definitions/explore/definitions/field_selector_properties'
      measures:
        description: List of measure names. Use ''*'' to select all measures (default)
        $ref: '#/definitions/explore/definitions/field_selector_properties'
      theme:
        oneOf:
          - type: string
            description: Name of an existing theme to apply to the dashboard
          - $ref: '#/definitions/theme/definitions/theme_properties'
            description: Inline theme configuration.
        description: Name of the theme to use. Only one of theme and embedded_theme can be set.
      time_ranges:
        type: array
        description: Overrides the list of default time range selections available in the dropdown. It can be string or an object with a 'range' and optional 'comparison_offsets'
        items:
          $ref: '#/definitions/explore_time_range_properties'
      time_zones:
        type: array
        description: Refers to the time zones that should be pinned to the top of the time zone selector. It should be a list of [IANA time zone identifiers](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)
        items:
          type: string
      lock_time_zone:
        type: boolean
        description: When true, the dashboard will be locked to the first time provided in the time_zones list. When no time_zones are provided, the dashboard will be locked to UTC
      allow_custom_time_range:
        type: boolean
        description: Defaults to true, when set to false it will hide the ability to set a custom time range for the user.
      defaults:
        type: object
        description: defines the defaults YAML struct
        properties:
          dimensions:
            description: Provides the default dimensions to load on viewing the dashboard
            $ref: '#/definitions/explore/definitions/field_selector_properties'
          measures:
            description: Provides the default measures to load on viewing the dashboard
            $ref: '#/definitions/explore/definitions/field_selector_properties'
          time_range:
            description: Refers to the default time range shown when a user initially loads the dashboard. The value must be either a valid [ISO 8601 duration](https://en.wikipedia.org/wiki/ISO_8601#Durations) (for example, PT12H for 12 hours, P1M for 1 month, or P26W for 26 weeks) or one of the [Rill ISO 8601 extensions](https://docs.rilldata.com/reference/rill-iso-extensions#extensions)
            type: string
          comparison_mode:
            description: 'Controls how to compare current data with historical or categorical baselines. Options: `none` (no comparison), `time` (compares with past based on default_time_range), `dimension` (compares based on comparison_dimension values)'
            type: string
          comparison_dimension:
            description: 'for dimension mode, specify the comparison dimension by name'
            type: string
        additionalProperties: false
      embeds:
        type: object
        description: Configuration options for embedded dashboard views
        properties:
          hide_pivot:
            type: boolean
            description: When true, hides the pivot table view in embedded mode
        additionalProperties: false
      security:
        description: Security rules to apply for access to the explore dashboard
        $ref: '#/definitions/security_policy_properties'
    required:
      - type       
  - $ref: '#/definitions/common_properties'
definitions:
  explore_time_range_properties:
    oneOf:
      - type: string
        description: a valid [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601#Durations) duration or one of the [Rill ISO 8601 extensions](https://docs.rilldata.com/reference/rill-iso-extensions#extensions) extensions for the selection
      - type: object
        description: Object containing time range and comparison configuration
        properties:
          range:
            type: string
            description: a valid [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601#Durations) duration or one of the [Rill ISO 8601 extensions](https://docs.rilldata.com/reference/rill-iso-extensions#extensions) extensions for the selection
          comparison_offsets:
            type: array
            description: list of time comparison options for this time range selection (optional). Must be one of the [Rill ISO 8601 extensions](https://docs.rilldata.com/reference/rill-iso-extensions#extensions)
            items:
              oneOf:
                - type: string
                  description: Offset string only (range is inferred)
                - type: object
                  description: Object containing offset and range configuration for time comparison
                  properties:
                    offset:
                      type: string
                      description: Time offset for comparison (e.g., 'P1D' for one day ago)
                    range:
                      type: string
                      description: Custom time range for comparison period
                  additionalProperties: false
        required:
          - range
        additionalProperties: false
  security_policy_properties:
    type: object
    description: Defines security rules and access control policies for resources
    properties:
      access:
        oneOf:
          - type: string
            description: SQL expression that evaluates to a boolean to determine access
          - type: boolean
            description: Direct boolean value to allow or deny access
        description: Expression indicating if the user should be granted access to the dashboard. If not defined, it will resolve to false and the dashboard won't be accessible to anyone. Needs to be a valid SQL expression that evaluates to a boolean.
      row_filter:
        type: string
        description: SQL expression to filter the underlying model by. Can leverage templated user attributes to customize the filter for the requesting user. Needs to be a valid SQL expression that can be injected into a WHERE clause
      include:
        type: array
        description: List of dimension or measure names to include in the dashboard. If include is defined all other dimensions and measures are excluded
        items:
          type: object
          properties:
            if:
              type: string
              description: Expression to decide if the column should be included or not. It can leverage templated user attributes. Needs to be a valid SQL expression that evaluates to a boolean
            names:
              anyOf:
                - type: array
                  description: List of specific field names to include
                  items:
                    type: string
                - type: string
                  description: Wildcard '*' to include all fields
                  enum:
                    - '*'
              description: List of fields to include. Should match the name of one of the dashboard's dimensions or measures
          required:
            - if
            - names
      exclude:
        type: array
        description: List of dimension or measure names to exclude from the dashboard. If exclude is defined all other dimensions and measures are included
        items:
          type: object
          properties:
            if:
              type: string
              description: Expression to decide if the column should be excluded or not. It can leverage templated user attributes. Needs to be a valid SQL expression that evaluates to a boolean
            names:
              anyOf:
                - type: array
                  description: List of specific field names to exclude
                  items:
                    type: string
                - type: string
                  description: Wildcard '*' to exclude all fields
                  enum:
                    - '*'
              description: List of fields to exclude. Should match the name of one of the dashboard's dimensions or measures
          required:
            - if
            - names
      rules:
        type: array
        description: List of detailed security rules that can be used to define complex access control policies
        items:
          type: object
          description: Individual security rule definition
          properties:
            type:
              type: string
              enum:
                - access
                - field_access
                - row_filter
              description: Type of security rule - access (overall access), field_access (field-level access), or row_filter (row-level filtering)
            action:
              type: string
              enum:
                - allow
                - deny
              description: Whether to allow or deny access for this rule
            if:
              type: string
              description: Conditional expression that determines when this rule applies. Must be a valid SQL expression that evaluates to a boolean
            names:
              type: array
              items:
                type: string
              description: List of field names this rule applies to (for field_access type rules)
            all:
              type: boolean
              description: When true, applies the rule to all fields (for field_access type rules)
            sql:
              type: string
              description: SQL expression for row filtering (for row_filter type rules)
          required:
            - type
  common_properties:
    type: object
    title: "Common Properties"
    properties:
      name:
        type: string
        description: Name is usually inferred from the filename, but can be specified manually.
      refs:
        type: array
        description: 'List of resource references'
        items:
          type: string
          description: A string reference like `<resource-name>` or `<type/resource-name>`.
      dev:
        type: object
        description: Overrides any properties in development environment.
      prod:
        type: object
        description: Overrides any properties in production environment.
  explore:
    definitions:
      field_selector_properties:
        oneOf:
          - type: string
            const: '*'
            description: Wildcard(*) selector that includes all available fields in the selection
          - type: array
            items:
              type: string
            description: Explicit list of fields to include in the selection
          - type: object
            description: 'Advanced matching using regex, DuckDB expression, or exclusion'
            properties:
              regex:
                type: string
                description: Select dimensions using a regular expression
              expr:
                type: string
                description: DuckDB SQL expression to select fields based on custom logic
              exclude:
                type: object
                description: Select all dimensions except those listed here
            additionalProperties: false
            oneOf:
              - required:
                  - regex
              - required:
                  - expr
              - required:
                  - exclude
  theme:
    definitions:
      theme_properties:
        type: object
        properties:
          colors:
            type: object
            description: Used to override the dashboard colors. Either primary or secondary color must be provided.
            properties:
              primary:
                type: string
                description: Overrides the primary blue color in the dashboard. Can have any hex (without the '#' character), [named colors](https://www.w3.org/TR/css-color-4/#named-colors) or hsl() formats. Note that the hue of the input colors is used for variants but the saturation and lightness is copied over from the [blue color palette](https://tailwindcss.com/docs/customizing-colors).
              secondary:
                type: string
                description: Overrides the secondary color in the dashboard. Applies to the loading spinner only as of now. Can have any hex (without the '#' character), [named colors](https://www.w3.org/TR/css-color-4/#named-colors) or hsl() formats.
            anyOf:
              - required:
                  - primary
              - required:
                  - secondary 